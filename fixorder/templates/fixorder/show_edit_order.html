{% extends 'base.html' %}
{% block content %}
    <form method="post">
        {% csrf_token %}
        <h3>Информация о заказе</h3>
        {{ form.as_p }}

        <h3>Выполненные работы</h3>
        {{ work_formset.management_form }}

        <div id="work-forms">
            {% for form in work_formset %}
                <div class="work-form" {% if form.instance.id %}data-work-id="{{ form.instance.id }}"{% endif %}>
                    <select name="{{ form.prefix }}-description" class="form-control work-select">
                        <option value="" {% if not form.description.value %}selected{% endif %}>Выберите услугу</option>
                        {% for typical_work in typical_works %}
                            <option value="{{ typical_work.description }}" {% if form.description.value == typical_work.description %}selected{% endif %}>
                                {{ typical_work.description }}
                            </option>
                        {% endfor %}
                    </select>
                    <input type="number" name="{{ form.prefix }}-price" value="{{ form.price.value|default:0 }}" class="form-control" placeholder="Введите цену">
                    <input type="text" name="{{ form.prefix }}-warranty" value="{{ form.warranty.value|default:'' }}" class="form-control" placeholder="Гарантия">
                    <button type="button" class="btn btn-danger delete-work mt-2">Удалить работу</button>
                </div>
            {% endfor %}
        </div>

        <div id="empty-form" style="display:none;">
            <div class="work-form">
                <select name="description" class="form-control work-select">
                    <option value="">Выберите услугу</option>
                    {% for typical_work in typical_works %}
                        <option value="{{ typical_work.description }}">{{ typical_work.description }}</option>
                    {% endfor %}
                </select>
                <input type="number" name="price" value="0" class="form-control" placeholder="Введите цену">
                <input type="text" name="warranty" value="" class="form-control" placeholder="Гарантия">
                <button type="button" class="btn btn-danger delete-work mt-2">Удалить работу</button>
            </div>
        </div>

        <button id="add-work" type="button" class="btn btn-primary mt-3">Добавить работу</button>
        <button type="submit" class="btn btn-success mt-3">Сохранить</button>
    </form>
{% endblock %}
