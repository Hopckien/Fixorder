{% extends 'fixorder/base.html' %}
{% block content %}
<form action="" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <br>
    <table class="table table-hover table-sm w-auto">
        {{ form.as_table }}
    </table>

    <div class="form-error">{{ form.errors }}</div>
    <div class="form-error">{{ form.non_field_errors }}</div>
    <button type="submit" class="btn btn-outline-success">Создать</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        console.log('DOM fully loaded and parsed');
        const clientSelect = document.getElementById('client-select');
        const clientName = document.getElementById('client-name');
        const clientPhone = document.getElementById('client-phone');
        const clientTelegram = document.getElementById('client-telegram');
        const clientViber = document.getElementById('client-viber');
        const clientWhatsapp = document.getElementById('client-whatsapp');

        // Проверяем наличие элементов
        console.log('clientSelect:', clientSelect);
        console.log('clientName:', clientName);
        console.log('clientPhone:', clientPhone);
        console.log('clientTelegram:', clientTelegram);
        console.log('clientViber:', clientViber);
        console.log('clientWhatsapp:', clientWhatsapp);

        clientSelect.addEventListener('change', function() {
            const clientId = this.value;
            console.log(`Selected client ID: ${clientId}`);
            if (clientId) {
                fetch(`/api/clients/${clientId}/`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Received data:', data);
                        clientName.value = data.name || '';
                        clientPhone.value = data.phone || '';
                        clientTelegram.value = data.telegram || '';
                        clientViber.value = data.viber || '';
                        clientWhatsapp.value = data.whatsapp || '';
                    })
                    .catch(error => {
                        console.error('There was a problem with the fetch operation:', error);
                    });
            } else {
                clientName.value = '';
                clientPhone.value = '';
                clientTelegram.value = '';
                clientViber.value = '';
                clientWhatsapp.value = '';
            }
        });
    });
</script>
{% endblock %}
